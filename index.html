<!DOCTYPE html>
<html>
    <head>
        <title>Frameworks em JS - Herberth Amaral</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <link rel="stylesheet" href="js/deck.js/core/deck.core.css">
        <link rel="stylesheet" href="js/deck.js/extensions/goto/deck.goto.css">
        <link rel="stylesheet" href="js/deck.js/extensions/menu/deck.menu.css">
        <link rel="stylesheet" href="js/deck.js/extensions/navigation/deck.navigation.css">
        <link rel="stylesheet" href="js/deck.js/extensions/status/deck.status.css">
        <link rel="stylesheet" href="js/deck.js/extensions/hash/deck.hash.css">
	
        <!-- Theme CSS files (menu swaps these out) -->
        <link rel="stylesheet" id="style-theme-link"      href="js/deck.js/themes/style/web-2.0.css">
        <link rel="stylesheet" id="transition-theme-link" href="js/deck.js/themes/transition/horizontal-slide.css">
        <link rel="stylesheet" href="js/deck.js/extensions/deck.js-codemirror/deck.codemirror.css">
        <link rel="stylesheet" href="js/deck.js/extensions/deck.js-codemirror/themes/default.css">
        <link rel="stylesheet" href="css/font/stylesheet.css" />
        <style type="text/css">
            h1.fontface 
            {
                font: 80px/88px 'DistantGalaxyRegular', Arial, sans-serif !important;
                letter-spacing: 1;
                text-align:center;
            }
            h2{}
            p.bottom {}
            small { font-size:26px;}
            table { width:100%; }
            tr>td:last-child{ padding: 4px 4px 4px 4px;font-weight:bold; margin: 5px 5px 5px 5px; text-align:right;}
        </style>
    </head>
    <body class="deck-container">
        <section class="slide">
            <h1 class="fontface">Frameworks MVC/MVVM em JavaScript</h1>
            <h2 style="text-align:center;margin-top:600px;">
                <a href="http://twitter.com/HerberthAmaral">@HerberthAmaral</a>
            </h2>
        </section>
        <section class="slide">
            <h2>O início</h2>
            <ul>
                <li class="slide">API de acesso ao DOM era <strong>horrível</strong></li>
            	<li class="slide">Quem é que não lembra do famoso document.getElementById()?</li>
            	<li class="slide">E do document.forms?</li>
            	<li class="slide">Escrever JavaScript era chato.</li>
            </ul>
            <div class="slide">
                <img src="imgs/bored.jpg" alt="bored"/>
                <p style="text-align:center !important;"><em>Oh God, mais um formulário pra validar...</em></p>
            </div>
        </section>
        <section class="slide" data-x="1000">
            <h2>~le js libz~</h2>
            <ul>
                <li>jQuery, Mootools, Prototype, YUI ao resgate!</li>
            	<li class="slide">APIs limpas, manipulação de DOM para todos.</li>
            	<li class="slide">"Baterias" extras, como efeitos, animações, AJAX.</li>
            </ul>
            <div class="slide">
                <img src="imgs/sweetjesus.jpg" alt="sweet jesus!"/>
                <p style="text-align:center !important;"><em>Sweet Jesus, I love jQuery.</em></p>
            </div>
        </section>
        <section class="slide" data-x="2000">
            <h2>Mas...</h2>
            <ul>
                <li class="slide">Essas libs são ótimas no <strong>acesso à DOM</strong></li>
                <li class="slide">Elas não dizem como você deve <strong>organizar sua app</strong></li>
                <li class="slide">O acesso à DOM melhorou, mas ainda temos uma abordagem <strong>orientada à eventos</strong></li>
            </ul>
            <div class="slide">
                <textarea class="code" mode="javascript" style="display:none" runnable="true">
$(document).ready(function(){
    $('form').submit(function(){
        $('form').hide();
        $('#uploading').show();
    }).find('input[type=checkbox][name=is_on_twitter]').change(function(){
        if($(this).is(':checked')){
            $(this).parent().find('span.is_on_twitter').hide();
        }
        else{
            $(this).parent().find('span.is_on_twitter').show();
        }
    });
    $('button.add').click(function(){
        $('ul.persons').append('...');
    });
});
                </textarea>
            </div>
        </section>
        <section class="slide" data-x="3000">
            <p style="margin-top:60px;">
                <img src="imgs/ohgod.png" alt="oh god, why?" width="420" height="530"/>
            </p>
        </section>
        <section class="slide">
            <h2>Algumas implicações.</h2>
            <ul>
                <li class="slide">Código macarrônico;</li>
                <li class="slide">Complexidade/manutenabilidade do código cresce em proporção <strong>geométrica</strong> enquanto a
                complexidade das interações cresce em proporção <strong>aritimética</strong>;</li>
                <li class="slide">Número gigantesco de <strong>WTF/min</strong> (métrica internacionalmente conhecida para avaliação de
                qualidade de código);</li>
                <li class="slide">Testabilidade <strong>seriamente</strong> comprometida.</li>
            </ul>
        </section>
        <section class="slide">
            <h2>E se...</h2>
            <ul>
                <li class="slide">Pudéssemos ter uma melhor <strong>SoC?</strong></li>
                <li class="slide">Pudéssemos escrever <strong>regras de interação</strong> sem mexer com o DOM?</li>
                <li class="slide">Pudéssemos mudar o paradigma <strong>event-driven</strong> para <strong>data-driven?</strong></li>
                <li class="slide">Pudéssemos <strong>testar o comportamento</strong> da nossa interface sem fixtures em HTML?</li>
            </ul>
        </section>
        <section class="slide">
            <p style="margin-top:120px;">
                <img src="imgs/yeswecan.jpg" alt="Yes, we can!" />
            </p>
        </section>
        <section class="slide">
            <p style="margin-top:120px;">
                <img src="imgs/backbone.jpg" alt="Backbone" />
            </p>
        </section>
        <section class="slide">
            <h2>Backbone.js</h2>
            <ul>
                <li class="slide"><em>Lembra</em> um MVC (não há na documentação algo que fale que o Backbone é um MVC);</li>
                <li class="slide">Views, Models, Collections e Routers (<em>lembra</em> um controller);</li>
                <li class="slide">Integra nativamente com o Rails (RESTful API), mas pode integrar com qualquer app com um pouco de
                configuração.</li>
            </ul>
        </section>
        <section class="slide">
            <h2>Como o Backbone.js me ajuda?</h2>
            <ul>
                <li class="slide">"Alivia" um pouco o event-driven programming;</li>
                <li class="slide">Mudanças nos models são automaticamente sincronizadas no DOM;</li>
                <li class="slide">Convenção estrutural: o Backbone já vem com uma;</li>
                <li class="slide">Testabilidade <em>facilitada</em>.</li>
            </ul>
        </section>
        <section class="slide">
            <div style="margin-top:60px;">
                <img alt="estrutura do backbonejs" src="imgs/backbone_estrutura.png"/>
                <p style="text-align:center !important;">*Note que os models são independentes.</p>
            </div>
        </section>
        <section class="slide">
            <h2>Backbone - Routers</h2>
            <textarea class="code" mode="javascript" style="display:none">
var Workspace = Backbone.Router.extend({
  routes: {
    "help":                 "help",    // #help
    "search/:query":        "search",  // #search/kiwis
    "search/:query/p:page": "search"   // #search/kiwis/p7
  },
  help: function() {
    ...
  },
  search: function(query, page) {
    ...
  }
});
            </textarea>
            <ul>
            	<li class="slide">URLs também fazem parte da UI!</li>
            	<li class="slide">Navegabilidade fácil, sem reload (e sem necessariamente AJAX);</li>
                <li class="slide">Routing + Controllers do Rails -- URLs + Views do Django;</li>
                <li class="slide"><strong>help</strong> e <strong>search</strong> podem consultar collections, fazer fetch em
                models e renderizar views;</li>
                <li class="slide">Funciona de forma <strong>desacoplada</strong> do Backbone, podendo ser utilizado com outros
                frameworks tranquilamente.</li>
            </ul>
        </section>
        <section class="slide">
            <h2>Backbone - Events</h2>
            <textarea class="code" mode="javascript" style="display:none" runnable="true" globals="$,Backbone,_">
var object = {};
_.extend(object, Backbone.Events);
object.bind("alert", function(msg) {
  alert("Triggered " + msg);
});
object.trigger("alert", "an event");
            </textarea>
            <ul>
            	<li class="slide">Boa parte da comunicação entre objetos no Backbone é feita através de eventos;</li>
                <li class="slide">Quase toda ação(ex. salvar um model, mudar uma propriedade) resulta num disparo de 
                evento, que pode ser tratado ou ignorado;</li>
            	<li class="slide">Forma conveniente de desacoplar aplicação.</li>
            </ul>
        </section>
        <section class="slide">
            <h2>Backbone - Models</h2>
            <textarea class="code" mode="javascript" style="display:none" runnable="true" globals="$,Backbone,_">
var Produto = Backbone.Model.extend({
     defaults:{
        nome:'',
        preco: 0.0,
        estoque: 0
    },
    validate: function(attrs){
        var err = "";
        if (attrs.nome !== undefined && attrs.nome == ''){
            err = "Nome não pode ser vazio";
        }
        else if (attrs.preco !== undefined && isNaN(parseFloat(attrs.preco))){
            var err = "Valor inválido pra preço";
        }
        console.log(err);
        return err;
    }
});
var p = new Produto();
p.set({preco:'Alvejante'});
p.save();
    </textarea>
        <ul>
            <li class="slide"><strong>get</strong> e <strong>set</strong> - Obtém/muda propriedades e dispara eventos
            quando necessário;</li>
            <li class="slide">O método <strong>validate</strong> é chamado antes do <strong>set</strong> e antes do
            <strong>save</strong> e o parâmetro <strong>attrs</strong> contém os dados que irão mudar. Um evento
            <strong>error</strong> é disparado em caso de erro de validação;</li>
            <li class="slide"><strong>set</strong> retorna a própria instância (<strong>this</strong>) caso os dados
            tenham passado na validação e <strong>false</strong> caso contrário.</li> 
        	<li class="slide">Um segundo parâmetro de opções pode ser passado pro set. É possível passar um callback
            <strong>error</strong> que será chamado se a validação falhar.</li>
        </ul>
        </section>
        <section class="slide">
        	<h2>Backbone - Collections</h2>
            <textarea class="code" mode="javascript" style="display:none" runnable="true" globals="$,Backbone,_">
var Produto = Backbone.Model.extend({});
var ProdutoCollection  = Backbone.Collection.extend({
    model: Produto,
    url: '/produtos',
});
var produtos = new ProdutoCollection();
produtos.fetch(); //obtem produtos do servidor ou do armazenamento local
produtos.add(new Produto({'nome':'Alvejante', 'preco':5.61}));
produtos.add(new Produto({'nome':'Vassoura', 'preco':8.90}));
produtos.add(new Produto({'nome':'Escova', 'preco':15.20}));
console.log(JSON.stringify(produtos.filter(function(obj){ return obj.get('preco')>6})));
            </textarea>
        	<ul>
        		<li class="slide">Conjunto ordenado de models.</li>
        		<li class="slide">Possível fazer "consultas" com a ajuda do Underscore.js;</li>
        		<li class="slide">Carregamento de objetos do server em massa (com o fetch);</li>
                <li class="slide">Delega para o <strong>Backbone.sync</strong> o trabalho de persistência. Dessa forma,
                pode-se usar persistência local, remota (padrão, pré-habilitada) ou ambos.</li>
        	</ul>
        </section>
        <section class="slide">
        	<h2>Backbone - Views</h2>
            <textarea class="code" mode="javascript" style="display:none" runnable="true" globals="$,Backbone,_">
var DocumentRow = Backbone.View.extend({
    tagName: "li",
    className: "document-row",
    events: {
        "click .icon":          "open",
        "click .button.edit":   "openEditDialog",
        "click .button.delete": "destroy"
    },
    initialize:function(){
        _.bindAll(this, "render");
        this.model.bind('change', this.render);
    }
    render: function() {
        //...
    },
    open: function(){
        //...
    },
    openEditDialog: function(){
        //...
    },
    destroy: function(){
        //...
    }
});
            </textarea>
        	<ul>
        		<li class="slide">Não há muita coisa de especial numa view. É mais uma convenção do que uma entidade
                realmente necessária;</li>
        		<li class="slide">Uma view geralmente está atrelada a um ou mais models;</li>
                <li class="slide">Pode renderizar-se automaticamente quando o model muda
                (<strong>this.model.bind('change', this.render())</strong>);</li>
        		<li class="slide">Vinculação de sentido único (one way binding -- do model para a view) por padrão.</li>
        	</ul>
        </section>
        <section class="slide">
            <h2>Backbone - Prós</h2>
            <ul>
            	<li>Comunidade grande e ativa;</li>
            	<li>Integração nativa com o Rails;</li>
            	<li>Flexível: você pode usar somente o que precisa;</li>
            	<li>Estrutura já bem difundida entre devs web;</li>
            	<li>Core extremamente reduzido (4.6k empacotado e gzipado);</li>
            	<li>Integra facilmente com plugins do jQuery;</li>
            	<li>Testabilidade razoável.</li>
            </ul>
            <div class="slide">
                <h2>Backbone - Contras</h2>
                <ul>
                	<li>Boilerplate;</li>
                	<li>Curva de aprendizado íngreme no começo se comparado à outros Frameworks;</li>
                	<li>Múltiplas responsabilidades nas Views e nos Models;</li>
                    <li>O core é pequeno, mas já há duas dependências por padrão (jQuery, Underscore); E você vai 
                    acabar usando mais outras dependências de terceiros;</li>
                </ul>
            </div>
        </section>
        <section class="slide">
            <h2>Avaliação geral</h2>
            <table with="100%" align="center">
            	<tr>
            		<th>Item</th>
            		<th>&nbsp;</th>
            		<th>Nota</th>
            	</tr>
            	<tr>
            		<td>Facilidade de uso</td>
            		<td>&nbsp;</td>
            		<td>9/10</td>
            	</tr>
            	<tr>
            		<td>Verbosidade</td>
            		<td>&nbsp;</td>
            		<td>7/10</td>
            	</tr>
            	<tr>
            		<td>Facilidade de integração com backend </td>
            		<td>&nbsp;</td>
            		<td>9/10</td>
            	</tr>
            	<tr>
                    <td>SoC</td>
            		<td>&nbsp;</td>
            		<td>8/10</td>
            	</tr>
            	<tr>
            		<td>Suporte</td>
            		<td>&nbsp;</td>
            		<td>10/10</td>
            	</tr>
            	<tr>
            		<td>Qualidade de documentação</td>
            		<td>&nbsp;</td>
            		<td>9/10</td>
            	</tr>
            	<tr>
            		<td>Recursos que vem por padrão</td>
            		<td>&nbsp;</td>
            		<td>8/10</td>
            	</tr>
            	<tr>
            		<td>Recursos com plugins</td>
            		<td>&nbsp;</td>
            		<td>10/10</td>
            	</tr>
            	<tr>
            		<td>Comunidade</td>
            		<td>&nbsp;</td>
            		<td>10/10</td>
            	</tr>
            	<tr>
                    <td><strong>Média geral</strong></td>
            		<td>&nbsp;</td>
            		<td>8.9/10</td>
            	</tr>
            </table>
        </section>
        <section class="slide">
        	<h2>Baterias extras pro seu projeto com Backbone.js</h2>
        	<ul>
                <li class="slide"><a href="https://github.com/derickbailey/backbone.modelbinding">Backbone.Modelbinding </a>
                modelbinding melhorado. Indispensável;</li>
                <li class="slide"><a href="https://github.com/PaulUithol/Backbone-relational">Backbone relational</a> -
                Relacionamentos um-pra-um, um-pra-muitos, muitos-pra-muitos nos seus models;</li>
                <li class="slide"><a href="https://github.com/PaulUithol/backbone-tastypie">Backbone-tastypie</a>
                integração com o django-tastypie.</li>
        	</ul>
        </section>
        <section class="slide">
            <p style="margin-top:120px;">
                <img src="imgs/anderson_kick.jpg" alt="knockout" />
            </p>
        </section>
        <section class="slide">
        	<h2>Knockout.js</h2>
        	<ul>
                <li class="slide">Baseado no padrão MVVM;</li>
        		<li class="slide">Model, View, View-Model;</li>
        		<li class="slide">Nasceu na Microsoft e é uma especialização do Presentation Model do Fowler;</li>
        		<li class="slide">Diferente do MVC, o MVVM nasceu focado em desenvolvimento de UIs modernas, com
                interações complexas;</li>
                <li class="slide">ViewModel != Controller. Diferente do controller, o viewmodel <strong>não</strong>
                sabe nada da view;</li>
                <li class="slide">Rastreamento de dependências (dependency tracking) e propriedades observáveis
                (observables);</li>
        		<li class="slide">Vinculação de via dupla (two-way binding). Mude o view-model e a view mudará. Mude a
                view e o view-model mudará. </li>
        		<li class="slide">Escrita em JavaScript puro;</li>
        		<li class="slide">Curva de adoção extremamente pequena; Independende da sua arquitetura atual, o ko
                encaixa-se sem problemas;</li>
        		<li class="slide">Escrita em JavaScript puro;</li>
        		<li class="slide">Rastreamento de dependências bem elegante;</li>
        		<li class="slide">Vínculos declarativos;</li>
        	</ul>
        </section>
        <section class="slide">
        	<h2>View & View-Model</h2>
            <textarea class="code" mode="html" style="display:none" runnable="true">
<div id="ko-exemplo1">
    Nome: <input type="text" data-bind="value: nome" /><br/>
    Sobrenome: <input type="text" data-bind="value: sobrenome" /><br/>
    Twitter?: <input type="checkbox" data-bind="checked: onTwitter" />
    <input type="text" data-bind="visible: onTwitter, value: twitter" placeholder="@username"/><br/>
    <p>Nome completo: <span data-bind="html: nome()+sobrenome()"></span></p>
    <button data-bind="click: submit">Enviar</button>
</div>
            </textarea>
            <textarea class="code" mode="javascript" style="display:none" runnable="true" globals="ko">
var viewModel = {
    nome: ko.observable(''),
    sobrenome: ko.observable(''),
    onTwitter: ko.observable(false),
    twitter: ko.observable(''),
    submit: function(){
        alert(JSON.stringify(ko.toJS(this)));
    }.bind(this)
};
            </textarea>
            <div id="ko-exemplo1">
    Nome: <input type="text" data-bind="value: nome" /><br/>
    Sobrenome: <input type="text" data-bind="value: sobrenome" /><br/>
    Twitter?: <input type="checkbox" data-bind="checked: onTwitter" />
    <input type="text" data-bind="visible: onTwitter, value: twitter" placeholder="@username"/><br/>
    <p>Nome completo: <span data-bind="html: nome()+sobrenome()"></span></p>
    <button data-bind="click: submit">Enviar</button>
            </div>
        </section>
        <section class="slide">
            <h2>Knockout.js</h2>
            <ul>
            	<li class="slide">Bindings nativos: text, visible, html, css, style, attr;</li>
            	<li class="slide">Controle de fluxo: foreach, if, ifnot, with;</li>
            	<li class="slide">Bindings de form: click, event, submit, enable, disable, value, hasfocus, checked,
                options, selectedOptions, uniqueName;</li>
            	<li class="slide">Renderização de templates;</li>
            	<li class="slide">Abordagem mais centrada no modelo de objetos do JS.</li>
            </ul>
        </section>
        <section class="slide">
            <textarea class="code" mode="javascript" style="display:none" runnable="true" globals="ko">
function Pessoa(){
    this.nome = ko.observable('');
    this.sobrenome = ko.observable('');
    this.twitter = ko.observable('')
    this.telefones = ko.observableArray();
}
var PessoaViewModel = function() {
    this.pessoas= ko.observableArray();
    this.nome= ko.observable('');
    this.sobrenome= ko.observable('');
    this.twitter= ko.observable('');
    this.onTwitter= ko.observable(false);
    this.adicionar= function(){
        var p = new Pessoa();
        p.nome(this.nome());
        p.sobrenome(this.sobrenome());
        if (this.onTwitter())
            p.twitter(this.twitter());
        this.pessoas.push(p);
    }.bind(this);
    this.remover = function(value){
        this.pessoas.remove(value);
        return false;
    }.bind(this);
}
var pessoas_view_model = new PessoaViewModel();
            </textarea>
            <textarea class="code" mode="html" style="display:none" runnable="true">
<ul data-bind="foreach: pessoas">
    <li><span data-bind="text: nome_completo()"></span>
    <button data-bind="click: $parent.remover.bind($data)">Remover</button>
</ul>
            </textarea>
            <div id="ko-exemplo2">
    Nome: <input type="text" data-bind="value: nome" /><br/>
    Sobrenome: <input type="text" data-bind="value: sobrenome" /><br/>
    Twitter?: <input type="checkbox" data-bind="checked: onTwitter" />
    <input type="text" data-bind="visible: onTwitter, value: twitter" placeholder="@username"/><br/>
    <p>Nome completo: <span data-bind="html: nome()+' '+sobrenome()"></span></p>
    <button data-bind="click: adicionar">Adicionar</button>
    <ul data-bind="foreach: pessoas">
        <li><span data-bind="text: nome()"></span>
        <button data-bind="click: $parent.remover.bind($data)">Remover</button>
    </ul>
            </div>
        </section>
        <section class="slide">
            <h2>Créditos das imagens</h2>
            <ul>
                <li>http://www.flickr.com/photos/9036026@N08/3010859705/</li>
                <li>http://www.flickr.com/photos/joecrimmings/2238699461/</li>
                <li>http://www.flickr.com/photos/35555684@N00/2574208762/</li>
                <li>http://zinganobjj.com/black-house-mma-wins-gym-of-the-year-award-at-the-2011-mma-awards-show/</li>
            </ul>
        </section>
        <script type="text/javascript" src="js/jquery.js"></script>
        <script type="text/javascript" src="js/knockout-2.0.0.js"></script>
        <script type="text/javascript" src="js/underscore.js"></script>
        <script type="text/javascript" src="js/backbone.js"></script>
        <script src="js/deck.js/core/deck.core.js"></script>
        <script src="js/deck.js/extensions/hash/deck.hash.js"></script>
        <script src="js/deck.js/extensions/menu/deck.menu.js"></script>
        <script src="js/deck.js/extensions/goto/deck.goto.js"></script>
        <script src="js/deck.js/extensions/status/deck.status.js"></script>
        <script src="js/deck.js/extensions/navigation/deck.navigation.js"></script>
        <script src="js/deck.js/extensions/deck.js-codemirror/codemirror.js"></script>
        <script src="js/deck.js/extensions/deck.js-codemirror/mode/javascript/javascript.js"></script>
        <script src="js/deck.js/extensions/deck.js-codemirror/mode/htmlmixed/htmlmixed.js"></script>
        <script src="js/deck.js/extensions/deck.js-codemirror/mode/xml/xml.js"></script>
        <script src="js/deck.js/extensions/deck.js-codemirror/mode/css/css.js"></script>
        <script src="js/deck.js/extensions/deck.js-codemirror/mode/htmlmixed/htmlmixed.js"></script>
        <script src="js/deck.js/extensions/deck.js-codemirror/deck.codemirror.js"></script>
        <script src="js/deck.js/modernizr.custom.js"></script>
        <script type="text/javascript">
            $(document).ready(function(){
                $.deck('.slide');
            });
        </script>
        <script src="js/ko_exemplo1.js"></script>
        <script src="js/ko_exemplo2.js"></script>
    </body>
</html>

